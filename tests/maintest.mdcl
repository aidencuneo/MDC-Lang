IMPORT 'functions.mdcl';

SIG INT 0;
TRY{(A):$1}:CATCH'outofrange':{ECHO'No input file given.';EXIT};
TRY{(C):READFILE$1}:CATCH'filenotfound':{'The path: "'ADD$1ADD'" could not be found.';EXIT};

NEW ERROR
: String *
: {
    'An error has occurred' ADD
    [ ":\n" < $0 > '.' ];
    ECHO $0 < $0 > '';
    EXIT;
};

NEW EVALUATE
: Array
: {
    (FA) : ARRAY;
    (F0) : '';
    FOR i : $0 : {
        IF i EQ RE'^[0-9]+' : {
            (FA) : (FA) ADD [ INTEGER i ];
        } : ELIF i EQ RE'^[0-9]*\.[0-9]+' : {
            (FA) : (FA) ADD [ FLOAT i ];
        } : ELIF i EQ RE'^".*"' OR [ i EQ RE"^'.*'" ] : {
            (FA) : (FA) ADD [ SPLICE i 1 -1 ];
        } : ELIF i EQ RE'^\[.*\]' : {
            (FA) INDEX [ INTEGER [ SPLICE i 1 -1 ] ];
        } : ELSE : {
            ERROR 'Unknown token.';
        };
    };
    YIELD (FA);
};

(D) : SPLIT (C) "\n\t\v\r" ONLY {YIELD$0<$0>NULL};
_EVALUATE (D);
